/*
 * SPEasyForms - modify SharePoint forms using jQuery (i.e. put fields on
 * tabs, show/hide fields, validate field values, modify the controls used
 * to enter field values etc.)
 *
 * 
 * @requires jQuery-ui v1.9.2 
 * @requires jQuery.SPServices v2015.02 or greater
 * @optional ssw Session Storage Wrapper - Cross Document Transport of
 *    JavaScript Data; used to cache the context across pages if available
 *    and options.useCache === true
 * @copyright 2014-2016 Joe McShea
 * @license under the MIT license:
 *    http://www.opensource.org/licenses/mit-license.php
 */
function shouldSPEasyFormsRibbonButtonBeEnabled(){return spefjQuery.spEasyForms.isConfigurableList()?!0:!1}spefjQuery=jQuery.noConflict(!0),function(n,t){function f(){for(var t=document.getElementsByTagName("script"),n=0;n<t.length;n++)return/jquery.speasyforms.*\.js/.test(t[n].src)?t[n]:_spPageContextInfo.siteServerRelativeUrl+"/Style Library/SPEasyFormsAssets/2015.01.07/JavaSccript/jquery.SPEasyForms.js"}var u,r,i;typeof SPClientTemplates!="undefined"&&SPClientTemplates.TemplateManager&&SPClientTemplates.TemplateManager.RegisterTemplateOverrides&&(window.location.href.indexOf("start.aspx#")>=0&&(u=f(),RegisterModuleInit(u,function(){SPClientTemplates.TemplateManager.RegisterTemplateOverrides({OnPreRender:function(){n("body").attr("data-speasyforms-formhidden")!=="true"&&n("body").attr("data-speasyforms-formhidden","true").append("<style type='text/css'>.ms-formtable { display: none; }<\/style>")}})})),SPClientTemplates.TemplateManager.RegisterTemplateOverrides({OnPreRender:function(){n("body").attr("data-speasyforms-formhidden")!=="true"&&n("body").attr("data-speasyforms-formhidden","true").append("<style type='text/css'>.ms-formtable { display: none; }<\/style>")}}));Object.keys||(Object.keys=function(t){return n.map(t,function(n,t){return t})});Object.create||(Object.create=function(n){function t(){}return t.prototype=n,new t});r=typeof ssw!="undefined"?ssw.get():t;n.spEasyForms={defaults:{useCache:typeof ssw!="undefined"||typeof ssw_init!="undefined",maxWebCache:6,maxListCache:10,maxNestingLevels:5,jQueryUITheme:"~sitecollection/Style Library/SPEasyFormsAssets/~version/Css/jquery-ui-redmond/jquery-ui.css",css:"~sitecollection/Style Library/SPEasyFormsAssets/~version/Css/speasyforms.css",formBodySelector:"table td.ms-formbody",fieldInternalNameRegex:/FieldInternalName=\"([^\"]*)\"/i,fieldDisplayNameRegex:/FieldName=\"([^\"]*)\"/i,fieldTypeRegex:/FieldType=\"([^\"]*)\"/i,fieldDisplayNameAltSelector:"h3.ms-standardheader",verbose:window.location.href.indexOf("spEasyFormsVerbose=true")>=0,initAsync:window.location.href.indexOf("spEasyFormsAsync=false")<0,version:"2015.01.07",jQueryUIGallery:["lilac","olive","redmond","salmon","smoothness","sunny"],loadDynamicStylesAlways:!1},isConfigurableList:function(t){var r=n.extend({},i.defaults,t);return(r.currentListContext||(r.currentListContext=n.spEasyForms.sharePointContext.getListContext(this.defaults)),!r.currentListContext)?!1:r.currentListContext.template==="102"||r.currentListContext.template==="108"?!1:!0},init:function(t){var r=n.extend({},i.defaults,t),e,o,u,f;if(!/\/SPEasyFormsSettings[a-zA-Z]*.aspx/.test(window.location.href)&&(e=n("td.ms-formlabel h3.ms-standardheader, td.ms-formlabel span.ms-standardheader"),o=e.first().closest("table"),o.find("iframe[id$='TextField_iframe']").length>0)){n("table.ms-formtable").show();ExecuteOrDelayUntilScriptLoaded(function(){var t=SP.UI.ModalDialog.get_childDialog();t!==null&&setTimeout(function(){(n(".ms-formtable").css("display")==="none"||n("#spEasyFormsContainersPre").length>0)&&n.spEasyForms.utilities.resizeModalDialog()},3e3)},"sp.ui.dialog.js");return}this.initCacheLibrary(r);r.callback=i.contextReady;this.options=r;n("#spEasyFormsBusyScreen").dialog({autoOpen:!1,dialogClass:"speasyforms-busyscreen",closeOnEscape:!1,draggable:!1,width:250,minHeight:25,modal:!0,buttons:{},resizable:!1});n("#spEasyFormsBusyScreen").html("Initializing Form...").dialog("open");r.initAsync?n.spEasyForms.sharePointContext.initAsync(r):this.contextReady(t);ExecuteOrDelayUntilScriptLoaded(function(){var t=SP.UI.ModalDialog.get_childDialog();t!==null&&setTimeout(function(){(n(".ms-formtable").css("display")==="none"||n("#spEasyFormsContainersPre").length>0)&&n.spEasyForms.utilities.resizeModalDialog()},3e3)},"sp.ui.dialog.js");u=n.spEasyForms.utilities.getRequestParameters();f=n.spEasyForms.sharePointFieldRows.init(t);n.each(Object.keys(u),function(t,i){if(i.indexOf("spef_")===0){var e=i.substring(5);e in f&&(r.row=f[e],r.value=u[i],n.spEasyForms.sharePointFieldRows.setValue(r))}});n.spEasyForms.defaults.verbose&&n("#spEasyFormsDiagButton").show().click(function(){var i=window.open();i.document.write("<pre>\n"+JSON.stringify(n.spEasyForms.sharePointContext.getListContext(t),null,4)+"\n<\/pre>");i.document.close()})},contextReady:function(t){var r=n.extend({},i.defaults,t),u,f;try{r.currentContext=n.spEasyForms.sharePointContext.get(r);r.source=n.spEasyForms.utilities.getRequestParameters(r).Source;r.currentListContext=n.spEasyForms.sharePointContext.getListContext(r);r.loadDynamicStylesAlways&&i.loadDynamicStyles(r);i.isSettingsPage(r)?i.containsOldRichTextFields(r)||i.toEditor(r):i.isTransformable(r)?(i.transform(r),_spPageContextInfo.webUIVersion===4&&(u=function(n){return n.substr(0,n.indexOf("?"))},u(document.referrer)!==u(window.location.href)?n("span.ms-error, span.ms-formvalidation").hide():n("span.ms-error, span.ms-formvalidation").show(),f=n("span.ms-formvalidation[role='alert']"),n.each(f,function(t,i){n(i).prev().hasClass("ms-formvalidation")&&n(i).hide()}))):i.isConfigurableListSettings(r)?i.insertListSettingsLink(r):window.location.href.toLowerCase().indexOf("/settings.aspx")>0&&i.insertSiteSettingsLink(r)}finally{n("table.ms-formtable ").show();ExecuteOrDelayUntilScriptLoaded(function(){var t=SP.UI.ModalDialog.get_childDialog();t!==null&&setTimeout(function(){(n(".ms-formtable").css("display")==="none"||n("#spEasyFormsContainersPre").length>0)&&n.spEasyForms.utilities.resizeModalDialog()},3e3)},"sp.ui.dialog.js");n("#spEasyFormsBusyScreen").dialog("close")}return this},containsOldRichTextFields:function(i){var r=[],f=function(){var t=!1;return r=[],n.each(Object.keys(i.currentListContext.schema),function(u,f){var e=i.currentListContext.schema[f];e.type==="Note"&&e.subtype==="RichText"&&(n.inArray(e.displayName,r)<0&&r.push(e.displayName),t=!0)}),t},u=f(),e;return u===!0&&(n.spEasyForms.clearCachedContext(i),n.spEasyForms.sharePointContext.ctx=t,i.currentContext=n.spEasyForms.sharePointContext.get(i),i.currentListContext=n.spEasyForms.sharePointContext.getListContext(i),u=f(),u===!0&&(n.spEasyForms.loadDynamicStyles(i),n("#spEasyFormsBusyScreen").dialog("close"),e={modal:!0,buttons:{Ok:function(){return window.location.href=n.spEasyForms.utilities.getRequestParameters(i).Source,!1}},autoOpen:!1,width:400},n("#spEasyFormsErrorDialog").attr("title","Unsupported Field Type"),n("#spEasyFormsErrorDialog").html("This list contains Rich Text Multi-line fields, which are not compatible with SPEasyForms (The display name(s) are: <b>"+r.join(", ")+"<\/b>).<br/><br/>If you wish to configure this list with SPEasyForms, you must change them to either Enhanced Rich Text or Plain Text Multi-line fields."),n("#spEasyFormsErrorDialog").dialog(e),n("#spEasyFormsErrorDialog").dialog("open"))),u},isConfigurableListSettings:function(t){var r=n.extend({},i.defaults,t);return i.isConfigurableList(r)?window.location.href.toLowerCase().indexOf("listedit.aspx")>=0:!1},isSettingsPage:function(t){var r=n.extend({},i.defaults,t);return i.isConfigurableList(r)?/\/SPEasyFormsSettings[a-zA-Z]*.aspx/.test(window.location.href):(/\/SPEasyFormsSettings[a-zA-Z]*.aspx/.test(window.location.href)&&n("#spEasyFormsInitializationError").show(),!1)},isTransformable:function(t){var r=n.extend({},i.defaults,t);return i.isConfigurableList(r)?n.spEasyForms.visibilityRuleCollection.getFormType(r).length===0?!1:n.spEasyForms.visibilityRuleCollection.getFormType(r)==="new"&&window.location.href.toLowerCase().indexOf("&type=1&")>=0?!1:window.location.href.toLowerCase().indexOf("&contenttypeid=0x0120")>=0?!1:!0:!1},transform:function(t){var r,i,u;t.currentConfig=n.spEasyForms.configManager.get(t);n.spEasyForms.defaults.formId="WPQ2";try{r=n("input[id$='_diidIOSaveItem']")[0].getAttributeNode("onclick").nodeValue;i=r.match(/SPClientForms\.ClientFormManager.SubmitClientForm\(\'([^\']*)\'/);i&&i.length>=2&&(n.spEasyForms.defaults.formId=i[1])}catch(f){}t.currentConfig.layout.def.length===1&&n.isEmptyObject(t.currentConfig.adapters.def)&&n.isEmptyObject(t.currentConfig.visibility.def)||(n(".ms-lookuptypeintextbox").each(function(){n().SPServices.SPComplexToSimpleDropdown({columnName:n(this).attr("title"),debug:t.verbose})}),n("table.ms-formtable").length===0&&n("td.ms-formlabel h3.ms-standardheader, td.ms-formlabel span.ms-standardheader").first().closest("table").addClass("ms-formtable"),n.spEasyForms.containerCollection.transform(t),typeof PreSaveItem!="undefined"&&(u=PreSaveItem,PreSaveItem=function(){var n=u();return n&&(n=spefjQuery.spEasyForms.containerCollection.preSaveItem()),n}),_spPageContextInfo.webUIVersion===4?n(".ui-widget input").css("font-size","8pt"):n("input[id$='_diidIOSaveItem']").each(function(){var t,i;null!==this.getAttributeNode("onclick")&&(t=this.getAttributeNode("onclick").nodeValue,t=t.replace("if (SPClientForms.ClientFormManager.SubmitClientForm('"+n.spEasyForms.defaults.formId+"')) return false;",""),i=document.createAttribute("onclick"),i.value=t,this.setAttributeNode(i))}))},toEditor:function(t){t.currentConfig=n.spEasyForms.configManager.get(t);n("#msCuiTopbar").prepend("<h2 class='speasyforms-breadcrumbs'><a href='"+t.source+"'>"+t.currentListContext.title+"<\/a>  -&gt; SPEasyForms Configuration<\/h2>");n.each(t.currentListContext.contentTypes.order,function(i,r){r.indexOf("0x0120")!==0&&n("#spEasyFormsContentTypeSelect").append("<option value='"+t.currentListContext.contentTypes[r].id+"'>"+t.currentListContext.contentTypes[r].name+"<\/option>")});n("#spEasyFormsContentTypeSelect").change(function(){delete n.spEasyForms.containerCollection.rows;delete n.spEasyForms.sharePointContext.formCache;t.contentTypeChanged=!0;t.refresh=n.spEasyForms.refresh.all;n.spEasyForms.containerCollection.toEditor(t)});n.spEasyForms.containerCollection.toEditor(t);n(window).on("beforeunload",function(){if(!n("#spEasyFormsSaveButton").hasClass("speasyforms-disabled"))return"You have unsaved changes, are you sure you want to leave the page?"});var i=n("#suiteBarTop").height()+n("#suitBar").height()+n("#s4-ribbonrow").height()+n("#spEasyFormsRibbon").height()+37;n("div.speasyforms-panel").height(n(window).height()-i);n("#spEasyFormsContent").height(n(window).height()-i).width(n(window).width()-460);n(window).resize(function(){n("div.speasyforms-panel").height(n(window).height()-i);n("#spEasyFormsContent").height(n(window).height()-i).width(n(window).width()-460)});n("#spEasyFormsRibbon").show()},insertListSettingsLink:function(t){var r=n("td.ms-descriptiontext:contains('description and navigation')").closest("table"),e=n("a:contains('Permissions for this list')"),i,u,f;e.length>0&&r.length>0&&(i=window.location.href,i.indexOf("start.aspx#")>=0&&(i=n.spEasyForms.utilities.webRelativePathAsAbsolutePath(i.substring(i.indexOf("#")+1))),u=n.spEasyForms.utilities.siteRelativePathAsAbsolutePath("/Style Library/SPEasyFormsAssets/2015.01.07/Pages/SPEasyFormsSettings.aspx")+"?ListId="+n.spEasyForms.sharePointContext.getCurrentListId(t)+"&SiteUrl="+n.spEasyForms.sharePointContext.getCurrentSiteUrl(t)+"&Source="+encodeURIComponent(i),f="<tr><td style='padding-top: 5px;' class='ms-descriptiontext ms-linksectionitembullet' vAlign='top' width='8' noWrap='nowrap'><img alt='' src='/_layouts/images/setrect.gif?rev=37' width='5' height='5' />&nbsp;<\/td><td class='ms-descriptiontext ms-linksectionitemdescription' vAlign='top'> <a href='"+u+"'>SPEasyForms Configuration<\/a><\/td><\/tr>",r.append(f))},insertSiteSettingsLink:function(){var f=n("h3:contains('Users and Permissions')"),e=f.next().find("a:contains('Site collection administrators')"),i,t,r,u;e.length>0&&(i=n("h3:contains('Site Collection Administration')").next(),i.length>0&&(t=window.location.href,t.indexOf("start.aspx#")>=0&&(t=n.spEasyForms.utilities.webRelativePathAsAbsolutePath(t.substring(t.indexOf("#")+1))),r=n.spEasyForms.utilities.siteRelativePathAsAbsolutePath("/Style Library/SPEasyFormsAssets/2015.01.07/Pages/SPEasyFormsSiteSettings.aspx")+"?Source="+encodeURIComponent(t),u="<li class='ms-linksection-listItem'><a title='Restore or permanently remove items that users have deleted on this site.' href='"+r+"'>SPEasyForms<\/a><\/li>",i.append(u)))},initCacheLibrary:function(n){typeof r=="undefined"&&n.cache!==t&&(r=n.cache);typeof ssw=="undefined"&&typeof ssw_init!="undefined"&&(ssw_init(window,document),typeof r=="undefined"&&(r=ssw.get()))},loadDynamicStyles:function(t){var r=n.extend({},i.defaults,t),u;r.currentConfig=n.spEasyForms.configManager.get(r);r.source="~sitecollection/Style Library/SPEasyFormsAssets/2015.01.07/Css/jquery-ui-smoothness/jquery-ui.css";u=this.replaceVariables(r);r.currentConfig&&r.currentConfig.jQueryUITheme?(r.source=r.currentConfig.jQueryUITheme,u=this.replaceVariables(r)):r.jQueryUITheme&&(r.source=r.jQueryUITheme,u=this.replaceVariables(r));n("head").append('<link rel="stylesheet" type="text/css" href="'+u+'">');r.source=r.css;u=this.replaceVariables(r);n("head").append('<link rel="stylesheet" type="text/css" href="'+u+'">');n.spEasyForms.userDefaults.additionalFiles&&n.each(n(n.spEasyForms.userDefaults.additionalFiles),function(t,i){if(/\.css$/.test(i)){r.source=i;var u=n.spEasyForms.replaceVariables(r);n("head").append('<link rel="stylesheet" type="text/css" href="'+u+'">')}})},replaceVariables:function(n){return n.source=n.currentContext.siteRelativeUrl.length===1?n.source.replace(/~sitecollection/g,""):n.source.replace(/~sitecollection/g,n.currentContext.siteRelativeUrl),n.source=n.source.replace(/~site/g,n.currentContext.webRelativeUrl),n.source=n.source.replace(/~version/g,n.version),n.source},clearCachedContext:function(t){var u=n.extend({},i.defaults,t);u.useCache&&(r={},ssw.clear())},writeCachedContext:function(t){var u=n.extend({},i.defaults,t),f,e;typeof ssw!="undefined"&&(f="spEasyForms_spContext_"+u.currentContext.webRelativeUrl,f in r||Object.keys(r).length>=u.maxWebCache&&ssw.remove(Object.keys(r)[0]),e={},e[f]=u.currentContext,ssw.add(e))},readCachedContext:function(u){var f=n.extend({},i.defaults,u),e;return f.useCache===!0?(e="spEasyForms_spContext_",f.siteUrl&&(e+=f.siteUrl),r[e]):t}};i=n.spEasyForms}(spefjQuery);
//# sourceMappingURL=jquery.SPEasyForms.min.js.map
